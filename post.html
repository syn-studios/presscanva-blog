<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="post-title">PressCanvas - Where words find their canvas</title>
    <meta name="description" content="" id="post-description">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" href="assets/favicon.ico">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'serif': ['Playfair Display', 'serif'],
                        'sans': ['Source Sans Pro', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#7c3aed',
                        'accent': '#8b5cf6',
                        'neutral-dark': '#374151',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for article content */
        .article-content {
            font-size: 18px;
            line-height: 1.7;
        }
        
        .article-content h1, .article-content h2, .article-content h3 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
            line-height: 1.3;
        }
        
        .article-content h1 { font-size: 2.5rem; }
        .article-content h2 { font-size: 2rem; }
        .article-content h3 { font-size: 1.5rem; }
        
        .article-content p {
            margin-bottom: 1.5rem;
        }
        
        .article-content p:first-of-type::first-letter {
            font-family: 'Playfair Display', serif;
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
            float: left;
            margin: 0.1rem 0.5rem 0 0;
            color: #7c3aed;
        }
        
        .article-content blockquote {
            border-left: 4px solid #7c3aed;
            padding-left: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
            font-size: 1.25rem;
            color: #6b7280;
        }
        
        .article-content img {
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            max-width: 100%;
            height: auto;
        }
        
        .article-content a {
            color: #7c3aed;
            text-decoration: underline;
            text-decoration-color: #8b5cf6;
            text-underline-offset: 2px;
        }
        
        .article-content a:hover {
            color: #8b5cf6;
        }
        
        .article-content code {
            background-color: #f3f4f6;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
        }
        
        .article-content pre {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
        }
        
        .article-content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .article-content ul, .article-content ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }
        
        .article-content li {
            margin-bottom: 0.5rem;
        }
        
        /* Reading progress bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #7c3aed, #8b5cf6);
            z-index: 100;
            transition: width 0.1s ease;
        }
    </style>
</head>
<body class="bg-white text-neutral-dark font-sans">
    <!-- Reading Progress Bar -->
    <div class="progress-bar" id="progress-bar"></div>
    
    <!-- Header -->
    <header class="border-b border-gray-100 bg-white/95 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-6 py-4">
            <nav class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <a href="index.html" class="flex items-center space-x-2">
                        <img src="assets/logo.png" alt="PressCanvas" class="w-8 h-8">
                        <h1 class="font-serif font-bold text-2xl text-primary">PressCanvas</h1>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-neutral-dark hover:text-primary transition-colors">← Back to Stories</a>
                    <a href="editor.html" class="bg-primary text-white px-4 py-2 rounded-full hover:bg-accent transition-colors font-medium text-sm">Write</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Article Header -->
    <article class="max-w-4xl mx-auto px-6 py-12">
        <header class="text-center mb-12">
            <div class="mb-4">
                <span id="post-date" class="text-primary font-medium text-sm uppercase tracking-wider"></span>
            </div>
            <h1 id="article-title" class="font-serif text-4xl md:text-6xl font-bold text-neutral-dark mb-6 leading-tight max-w-4xl mx-auto"></h1>
            <p id="article-excerpt" class="text-xl text-gray-600 leading-relaxed max-w-2xl mx-auto mb-8"></p>
            
            <!-- Author & Meta -->
            <div class="flex items-center justify-center space-x-6 text-sm text-gray-500 mb-8">
                <div class="flex items-center space-x-2">
                    <img src="/placeholder.svg?height=32&width=32" alt="Author" class="w-8 h-8 rounded-full">
                    <span id="post-author">PressCanvas</span>
                </div>
                <span>•</span>
                <span id="reading-time">5 min read</span>
            </div>
            
            <!-- Social Share -->
            <div class="flex items-center justify-center space-x-4">
                <button onclick="sharePost('twitter')" class="flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-primary hover:text-white transition-colors rounded-full text-sm">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                    </svg>
                    <span>Share</span>
                </button>
                <button onclick="sharePost('linkedin')" class="flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-primary hover:text-white transition-colors rounded-full text-sm">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                    <span>Share</span>
                </button>
                <button onclick="copyLink()" class="flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-primary hover:text-white transition-colors rounded-full text-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <span>Copy Link</span>
                </button>
            </div>
        </header>

        <!-- Article Content -->
        <div class="prose prose-lg max-w-none">
            <div id="article-content" class="article-content">
                <!-- Markdown content will be rendered here -->
            </div>
        </div>

        <!-- Article Footer -->
        <footer class="mt-16 pt-8 border-t border-gray-200">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                <div class="flex items-center space-x-4">
                    <img src="/placeholder.svg?height=48&width=48" alt="Author" class="w-12 h-12 rounded-full">
                    <div>
                        <h4 class="font-semibold text-neutral-dark">Written by <span id="footer-author">PressCanvas</span></h4>
                        <p class="text-gray-600 text-sm">Crafting stories that matter, one word at a time.</p>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <button onclick="sharePost('twitter')" class="p-2 text-gray-400 hover:text-primary transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                        </svg>
                    </button>
                    <button onclick="sharePost('linkedin')" class="p-2 text-gray-400 hover:text-primary transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </footer>
    </article>

    <!-- Related Posts -->
    <section class="bg-gray-50 py-16">
        <div class="max-w-6xl mx-auto px-6">
            <h3 class="font-serif text-3xl font-bold text-center text-neutral-dark mb-12">More Stories</h3>
            <div id="related-posts" class="grid md:grid-cols-3 gap-8">
                <!-- Related posts will be loaded here -->
            </div>
            <div class="text-center mt-12">
                <a href="index.html" class="inline-flex items-center text-primary font-medium hover:underline">
                    View All Stories
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <script>
        let currentPost = null;
        
        // Get slug from URL parameters
        function getSlugFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('slug');
        }
        
        // Load and render post
        async function loadPost() {
            const slug = getSlugFromURL();
            if (!slug) {
                window.location.href = 'index.html';
                return;
            }
            
            try {
                // Load post metadata
                const postsResponse = await fetch('data/posts.json');
                const posts = await postsResponse.json();
                currentPost = posts.find(post => post.slug === slug);
                
                if (!currentPost) {
                    throw new Error('Post not found');
                }
                
                let markdownContent = '';
                try {
                    const markdownResponse = await fetch(`_posts/${slug}.md`);
                    if (!markdownResponse.ok) {
                        throw new Error(`HTTP error! status: ${markdownResponse.status}`);
                    }
                    markdownContent = await markdownResponse.text();
                } catch (fetchError) {
                    console.warn('Could not fetch markdown file, using fallback content:', fetchError);
                    // Fallback: create content from post metadata
                    markdownContent = `---
title: "${currentPost.title}"
date: "${currentPost.date}"
excerpt: "${currentPost.excerpt}"
author: "PressCanvas"
---

${currentPost.excerpt}

*This post content could not be loaded from the markdown file. This might happen when running the site locally due to CORS restrictions. When deployed to GitHub Pages, the full content will be available.*

To see the full content, make sure:
1. The markdown file exists at \`_posts/${slug}.md\`
2. The site is served from a web server (not opened directly as a file)
3. The markdown file has proper frontmatter and content

**Excerpt:** ${currentPost.excerpt}`;
                }
                
                // Parse frontmatter and content
                const { frontmatter, content } = parseFrontmatter(markdownContent);
                
                // Update page metadata
                document.getElementById('post-title').textContent = `${currentPost.title} - PressCanvas`;
                document.getElementById('post-description').setAttribute('content', currentPost.excerpt);
                
                // Update article header
                document.getElementById('post-date').textContent = formatDate(currentPost.date);
                document.getElementById('article-title').textContent = currentPost.title;
                document.getElementById('article-excerpt').textContent = currentPost.excerpt;
                document.getElementById('post-author').textContent = frontmatter.author || 'PressCanvas';
                document.getElementById('footer-author').textContent = frontmatter.author || 'PressCanvas';
                
                // Calculate reading time
                const readingTime = calculateReadingTime(content);
                document.getElementById('reading-time').textContent = `${readingTime} min read`;
                
                // Render markdown content
                const htmlContent = marked.parse(content);
                document.getElementById('article-content').innerHTML = htmlContent;
                
                // Load related posts
                loadRelatedPosts(posts, currentPost);
                
            } catch (error) {
                console.error('Error loading post:', error);
                document.getElementById('article-content').innerHTML = `
                    <div class="text-center py-12">
                        <h2 class="font-serif text-2xl text-neutral-dark mb-4">Post Not Found</h2>
                        <p class="text-gray-600 mb-6">The story you're looking for doesn't exist or has been moved.</p>
                        <a href="index.html" class="bg-primary text-white px-6 py-3 rounded-full hover:bg-accent transition-colors">Back to Stories</a>
                    </div>
                `;
            }
        }
        
        // Parse frontmatter from markdown
        function parseFrontmatter(markdown) {
            const frontmatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
            const match = markdown.match(frontmatterRegex);
            
            if (!match) {
                return { frontmatter: {}, content: markdown };
            }
            
            const frontmatterText = match[1];
            const content = match[2];
            const frontmatter = {};
            
            frontmatterText.split('\n').forEach(line => {
                const [key, ...valueParts] = line.split(':');
                if (key && valueParts.length) {
                    frontmatter[key.trim()] = valueParts.join(':').trim().replace(/^["']|["']$/g, '');
                }
            });
            
            return { frontmatter, content };
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        // Calculate reading time
        function calculateReadingTime(text) {
            const wordsPerMinute = 200;
            const words = text.trim().split(/\s+/).length;
            return Math.ceil(words / wordsPerMinute);
        }
        
        // Load related posts
        function loadRelatedPosts(allPosts, currentPost) {
            const related = allPosts
                .filter(post => post.slug !== currentPost.slug)
                .slice(0, 3);
            
            const container = document.getElementById('related-posts');
            container.innerHTML = related.map(post => `
                <article class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow">
                    <img src="${post.cover || '/placeholder.svg?height=200&width=300&query=' + post.title}" alt="${post.title}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <div class="mb-2">
                            <span class="text-primary text-sm font-medium">${formatDate(post.date)}</span>
                        </div>
                        <h4 class="font-serif text-xl font-bold text-neutral-dark mb-3 leading-tight">
                            <a href="post.html?slug=${post.slug}" class="hover:text-primary transition-colors">${post.title}</a>
                        </h4>
                        <p class="text-gray-600 text-sm leading-relaxed">${post.excerpt}</p>
                    </div>
                </article>
            `).join('');
        }
        
        // Social sharing functions
        function sharePost(platform) {
            const url = window.location.href;
            const title = currentPost ? currentPost.title : 'Check out this story on PressCanvas';
            
            let shareUrl = '';
            switch (platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
                    break;
                case 'linkedin':
                    shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;
                    break;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        }
        
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                // Show feedback
                const button = event.target.closest('button');
                const originalText = button.innerHTML;
                button.innerHTML = button.innerHTML.replace('Copy Link', 'Copied!');
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            });
        }
        
        // Reading progress bar
        function updateProgressBar() {
            const article = document.getElementById('article-content');
            const progressBar = document.getElementById('progress-bar');
            
            if (!article) return;
            
            const articleTop = article.offsetTop;
            const articleHeight = article.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset;
            
            const progress = Math.min(
                Math.max((scrollTop - articleTop + windowHeight * 0.3) / articleHeight, 0),
                1
            );
            
            progressBar.style.width = `${progress * 100}%`;
        }
        
        // Event listeners
        window.addEventListener('scroll', updateProgressBar);
        window.addEventListener('resize', updateProgressBar);
        
        // Load post on page load
        loadPost();
    </script>
</body>
</html>
